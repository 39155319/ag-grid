{"version":3,"sources":["reactComponent.ts"],"names":[],"mappings":"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","file":"reactComponent.js","sourcesContent":["import { ReactPortal, createElement } from 'react';\nimport { createPortal } from 'react-dom';\nimport { _, ComponentType, Promise } from '@ag-grid-community/core';\nimport { AgGridReact } from \"./agGridReact\";\nimport { BaseReactComponent } from './baseReactComponent';\nimport { assignProperties } from './utils';\nimport generateNewKey from './keyGenerator';\nimport { renderToStaticMarkup } from 'react-dom/server';\n\nexport class ReactComponent extends BaseReactComponent {\n    static REACT_MEMO_TYPE = ReactComponent.hasSymbol() ? Symbol.for('react.memo') : 0xead3;\n\n    private eParentElement!: HTMLElement;\n    private componentInstance: any;\n\n    private reactComponent: any;\n    private componentType: ComponentType;\n    private parentComponent: AgGridReact;\n    private portal: ReactPortal | null = null;\n    private statelessComponent: boolean;\n    private statelessDomInsertedListener: null | (() => void)  = null;\n    private staticMarkup: HTMLElement | null | string = null;\n    private staticRenderTime: number = 0;\n\n    constructor(reactComponent: any, parentComponent: AgGridReact, componentType: ComponentType) {\n        super();\n\n        this.reactComponent = reactComponent;\n        this.componentType = componentType;\n        this.parentComponent = parentComponent;\n        this.statelessComponent = ReactComponent.isStateless(this.reactComponent);\n\n        if(this.isStatelessComponent()) {\n            this.statelessDomInsertedListener = () => {\n                this.removeStaticMarkup();\n            }\n        }\n    }\n\n    public getFrameworkComponentInstance(): any {\n        return this.componentInstance;\n    }\n\n    public isStatelessComponent(): boolean {\n        return this.statelessComponent;\n    }\n\n    public getReactComponentName(): string {\n        return this.reactComponent.name;\n    }\n\n    public init(params: any): Promise<void> {\n        this.eParentElement = this.createParentElement(params);\n        this.renderStaticMarkup(params);\n\n        if(this.isStatelessComponent()) {\n            this.eParentElement.addEventListener('DOMNodeInserted', this.statelessDomInsertedListener as any, false);\n        }\n\n        return new Promise<void>(resolve => this.createReactComponent(params, resolve));\n    }\n\n    public getGui(): HTMLElement {\n        return this.eParentElement;\n    }\n\n    public destroy(): void {\n        this.eParentElement.removeEventListener('DOMNodeInserted', this.statelessDomInsertedListener as any);\n        return this.parentComponent.destroyPortal(this.portal as ReactPortal);\n    }\n\n    private createReactComponent(params: any, resolve: (value: any) => void) {\n        if (!this.isStatelessComponent()) {\n            // grab hold of the actual instance created\n            params.ref = (element: any) => {\n                this.componentInstance = element;\n                this.addParentContainerStyleAndClasses();\n\n                // regular components (ie not functional)\n                this.removeStaticMarkup();\n            };\n        }\n\n        const reactComponent = createElement(this.reactComponent, params);\n        const portal: ReactPortal = createPortal(\n            reactComponent,\n            this.eParentElement as any,\n            generateNewKey() // fixed deltaRowModeRefreshCompRenderer\n        );\n\n        this.portal = portal;\n        this.parentComponent.mountReactPortal(portal, this, (value: any) => {\n            resolve(value);\n\n            // functional/stateless components have a slightly different lifecycle (no refs) so we'll clean them up\n            // here\n            if (this.isStatelessComponent()) {\n                setTimeout(() => this.removeStaticMarkup());\n            }\n        });\n    }\n\n    private addParentContainerStyleAndClasses() {\n        if (!this.componentInstance) {\n            return;\n        }\n\n        if (this.componentInstance.getReactContainerStyle && this.componentInstance.getReactContainerStyle()) {\n            assignProperties(this.eParentElement.style, this.componentInstance.getReactContainerStyle());\n        }\n\n        if (this.componentInstance.getReactContainerClasses && this.componentInstance.getReactContainerClasses()) {\n            const parentContainerClasses: string[] = this.componentInstance.getReactContainerClasses();\n            parentContainerClasses.forEach(className => _.addCssClass(this.eParentElement, className));\n        }\n    }\n\n    private createParentElement(params: any) {\n        const eParentElement = document.createElement(this.parentComponent.props.componentWrappingElement || 'div');\n\n        _.addCssClass(eParentElement as HTMLElement, 'ag-react-container');\n\n        // DEPRECATED - use componentInstance.getReactContainerStyle or componentInstance.getReactContainerClasses instead\n        // so user can have access to the react container, to add css class or style\n        params.reactContainer = eParentElement;\n\n        return eParentElement;\n    }\n\n    public statelessComponentRendered(): boolean {\n        // fixed fragmentsFuncRendererCreateDestroy funcRendererWithNan (changeDetectionService too for NaN)\n        return this.eParentElement.childElementCount > 0 || this.eParentElement.childNodes.length > 0;\n    }\n\n    private static hasSymbol() {\n        return typeof Symbol === 'function' && Symbol.for;\n    }\n\n    private static isStateless(Component: any) {\n        return (typeof Component === 'function' && !(Component.prototype && Component.prototype.isReactComponent))\n            || (typeof Component === 'object' && Component.$$typeof === ReactComponent.REACT_MEMO_TYPE);\n    }\n\n    public isNullRender(): boolean {\n        return this.staticMarkup === '';\n    }\n\n    /*\n     * Attempt to render the component as static markup if possible\n     * What this does is eliminate any visible flicker for the user in the scenario where a component is destroyed and\n     * recreated with exactly the same data (ie with force refresh)\n     * Note: Some use cases will throw an error (ie when using Context) so if an error occurs just ignore it any move on\n     */\n    private renderStaticMarkup(params: any) {\n        if (this.parentComponent.isDisableStaticMarkup() || (this.componentType.isCellRenderer && !this.componentType.isCellRenderer())) {\n            return;\n        }\n\n        const originalConsoleError = console.error;\n        const reactComponent = createElement(this.reactComponent, params);\n\n        try {\n            // if a user is doing anything that uses useLayoutEffect (like material ui) then it will throw and we\n            // can't do anything to stop it; this is just a warning and has no effect on anything so just suppress it\n            // for this single operation\n            const originalConsoleError = console.error;\n\n            console.error = () => {\n            };\n\n            const start = Date.now();\n            const staticMarkup = renderToStaticMarkup(reactComponent);\n            this.staticRenderTime = Date.now() - start;\n\n            console.error = originalConsoleError;\n\n            // if the render method returns null the result will be an empty string\n            if (staticMarkup === '') {\n                this.staticMarkup = staticMarkup;\n            } else {\n                if (staticMarkup) {\n                    // we wrap the content as if there is \"trailing\" text etc it's not easy to safely remove\n                    // the same is true for memoized renderers, renderers that that return simple strings or NaN etc\n                    this.staticMarkup = document.createElement('span');\n                    this.staticMarkup.innerHTML = staticMarkup;\n                    this.eParentElement.appendChild(this.staticMarkup);\n                }\n            }\n        } catch (e) {\n            // we tried - this can happen with certain (rare) edge cases\n        } finally {\n            console.error = originalConsoleError;\n        }\n    }\n\n    private removeStaticMarkup() {\n        if (this.parentComponent.isDisableStaticMarkup() || !this.componentType.isCellRenderer()) {\n            return;\n        }\n\n        if (this.staticMarkup) {\n            if ((this.staticMarkup as HTMLElement).remove) {\n                // everyone else in the world\n                (this.staticMarkup as HTMLElement).remove();\n                this.staticMarkup = null;\n            } else if (this.eParentElement.removeChild) {\n                // ie11...\n                this.eParentElement.removeChild(this.staticMarkup as any);\n                this.staticMarkup = null;\n            }\n        }\n    }\n\n    rendered(): boolean {\n        return this.isNullRender() ||\n            !!this.staticMarkup ||\n            !!(this.isStatelessComponent() && this.statelessComponentRendered()) ||\n            !!(!this.isStatelessComponent() && this.getFrameworkComponentInstance());\n    }\n}\n"]}